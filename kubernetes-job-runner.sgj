{"jobDefs":[{"version":"0.0","name":"Kubernetes Job Runner","maxInstances":1,"pauseOnJobFail":false,"runtimeVars":{},"schedules":[{"TriggerType":"cron","name":"run sample_app_1","isActive":false,"runtimeVars":{"FunctionKwargs":{"sensitive":false,"format":"yaml","value":"image_name: sample_app_1\nimage_tag: v0.0.1\njob_name: sample-app-1-job\nlabels:\n  jobGroup: saasglue\nnamespace: default"}},"cron":{"Second":"1","Timezone":"Etc/Greenwich"},"interval":{}},{"TriggerType":"cron","name":"run sample_app_2","isActive":false,"runtimeVars":{"FunctionKwargs":{"sensitive":false,"format":"yaml","value":"image_name: sample_app_2\nimage_tag: v0.0.1\njob_name: sample-app-2-job\nlabels:\n  jobGroup: saasglue\nnamespace: default"}},"cron":{"Second":"1","Timezone":"Etc/Greenwich"},"interval":{}}],"taskDefs":[{"target":4,"name":"Run Job","requiredTags":{"role":"kubernetes_job_runner"},"fromRoutes":[],"toRoutes":[],"autoRestart":false,"stepDefs":[{"name":"run","order":1,"command":"","arguments":"","variables":{},"lambdaCodeSource":"script","lambdaRuntime":"","lambdaMemorySize":128,"lambdaTimeout":3,"lambdaFunctionHandler":"","lambdaAWSRegion":"","lambdaDependencies":"","lambdaZipfile":"","scriptName":"CreateKubernetesJob.py"}],"exportWarnings":[]}]}],"scripts":[{"name":"CreateKubernetesJob.py","scriptType":0,"code":"aW1wb3J0IGpzb24KaW1wb3J0IHJlCmltcG9ydCBzeXMKaW1wb3J0IG9zCmltcG9ydCB0aW1lCmltcG9ydCB5YW1sCgpAc2dzKCJLdWJlcm5ldGVzQWNjZXNzLnB5IikKCmpvYl9zdGFydGVkID0gRmFsc2UKam9iX2NvbXBsZXRlZCA9IEZhbHNlCnNjaGVkdWxlZF90aW1lID0gIiIKbmFtZXNwYWNlID0gImRlZmF1bHQiCmt1YmVybmV0ZXNfYWNjZXNzID0gTm9uZQpwb2RzID0gW10KcG9kX3N0YXR1cyA9IHt9CgoKZGVmIGNyZWF0ZV9rdWJlcm5ldGVzX2pvYigqKmt3YXJncyk6CiAgICBrdWJlcm5ldGVzX25hbWVzcGFjZSA9IGt3YXJnc1sibmFtZXNwYWNlIl0KICAgIHByaW50KAogICAgICAgIGpzb24uZHVtcHMoewogICAgICAgICAgICAibWVzc2FnZSI6ICJDcmVhdGluZyBqb2IiLAogICAgICAgICAgICAiZGF0YSI6IGt3YXJncywKICAgICAgICB9KQogICAgKQogICAgc3lzLnN0ZG91dC5mbHVzaCgpCgogICAgaW1hZ2UgPSBrd2FyZ3NbImltYWdlX25hbWUiXQogICAgaWYgImltYWdlX3RhZyIgaW4ga3dhcmdzOgogICAgICAgIGltYWdlX3RhZyA9IGt3YXJnc1siaW1hZ2VfdGFnIl0KICAgICAgICBpbWFnZSA9IGYie2ltYWdlfTp7aW1hZ2VfdGFnfSIKCiAgICBjb21tYW5kID0ga3dhcmdzLmdldCgiY29tbWFuZCIpCgogICAgc2VydmljZV9hY2NvdW50X25hbWUgPSBrd2FyZ3MuZ2V0KCJzZXJ2aWNlX2FjY291bnRfbmFtZSIpCgogICAgaW1hZ2VfcHVsbF9wb2xpY3kgPSBrd2FyZ3MuZ2V0KCJpbWFnZV9wdWxsX3BvbGljeSIpIG9yICJJZk5vdFByZXNlbnQiCgogICAgZW52X3ZhcnMgPSBrd2FyZ3MuZ2V0KCJlbnYiKQoKICAgIHNlY3JldHMgPSBrd2FyZ3MuZ2V0KCJzZWNyZXRzIikKCiAgICB2b2x1bWVfY2xhaW1zID0ga3dhcmdzLmdldCgidm9sdW1lcyIpCgogICAgYWZmaW5pdGllcyA9a3dhcmdzLmdldCgiYWZmaW5pdGllcyIpCgogICAgdG9sZXJhdGlvbnMgPSBrd2FyZ3MuZ2V0KCJ0b2xlcmF0aW9ucyIpCgogICAgbGFiZWxzID0ga3dhcmdzLmdldCgibGFiZWxzIikKCiAgICBjb25maWdfbWFwcyA9IGt3YXJncy5nZXQoImNvbmZpZ19tYXBzIikKCiAgICBqb2Jfb2JqZWN0ID0ga3ViZXJuZXRlc19hY2Nlc3MuY3JlYXRlX2pvYl9vYmplY3QoCiAgICAgICAgY29udGFpbmVyX2ltYWdlPWltYWdlLAogICAgICAgIGltYWdlX3B1bGxfcG9saWN5PWltYWdlX3B1bGxfcG9saWN5LAogICAgICAgIG5hbWVzcGFjZT1rdWJlcm5ldGVzX25hbWVzcGFjZSwKICAgICAgICBjb250YWluZXJfbmFtZT1rd2FyZ3NbImpvYl9uYW1lIl0sCiAgICAgICAgc2VydmljZV9hY2NvdW50X25hbWU9c2VydmljZV9hY2NvdW50X25hbWUsCiAgICAgICAgY29tbWFuZD1jb21tYW5kLAogICAgICAgIGxhYmVscz1sYWJlbHMsCiAgICAgICAgZW52X3ZhcnM9ZW52X3ZhcnMsCiAgICAgICAgc2VjcmV0cz1zZWNyZXRzLAogICAgICAgIGNvbmZpZ19tYXBzPWNvbmZpZ19tYXBzLAogICAgICAgIGFmZmluaXRpZXM9YWZmaW5pdGllcywKICAgICAgICB0b2xlcmF0aW9ucz10b2xlcmF0aW9ucywKICAgICAgICB2b2x1bWVfY2xhaW1zPXZvbHVtZV9jbGFpbXMsCiAgICApCiAgICByZXR1cm4ga3ViZXJuZXRlc19hY2Nlc3MuY3JlYXRlX2pvYihrdWJlcm5ldGVzX25hbWVzcGFjZSwgam9iX29iamVjdCkKCmRlZiBvbl9wb2RfbG9nKG1lc3NhZ2UpOgogICAgcHJpbnQoCiAgICAgICAgewogICAgICAgICAgICAibWVzc2FnZSI6ICJQb2QgbG9nIG1lc3NhZ2UgcmVjZWl2ZWQiLAogICAgICAgICAgICAiY29udGVudCI6IG1lc3NhZ2UKICAgICAgICB9CiAgICApCiAgICBzeXMuc3Rkb3V0LmZsdXNoKCkKCmRlZiBvbl9wb2RfdXBkYXRlKHBvZCk6CiAgICBnbG9iYWwgcG9kcwogICAgZ2xvYmFsIHBvZF9zdGF0dXMKICAgIGdsb2JhbCBuYW1lc3BhY2UKICAgIGdsb2JhbCBrdWJlcm5ldGVzX2FjY2VzcwoKICAgIHBvZF9uYW1lID0gcG9kLm1ldGFkYXRhLm5hbWUKICAgIHVwZGF0ZWRfc3RhdHVzID0gcG9kLnN0YXR1cy5waGFzZSAgICAKICAgIGlmIHBvZF9uYW1lIG5vdCBpbiBwb2RzOgogICAgICAgIHBvZHMuYXBwZW5kKHBvZF9uYW1lKQogICAgICAgIHBvZF9zdGF0dXNbcG9kX25hbWVdID0gcG9kLnN0YXR1cy5waGFzZQogICAgaWYgdXBkYXRlZF9zdGF0dXMgIT0gcG9kX3N0YXR1c1twb2RfbmFtZV06CiAgICAgICAgcG9kX3N0YXR1c1twb2RfbmFtZV0gPSB1cGRhdGVkX3N0YXR1cwogICAgICAgIHByaW50KAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibWVzc2FnZSI6ICJQb2QgdXBkYXRlIiwgCiAgICAgICAgICAgICAgICAibmFtZSI6IHBvZF9uYW1lLCAKICAgICAgICAgICAgICAgICJzdGF0dXMiOiB1cGRhdGVkX3N0YXR1cwogICAgICAgICAgICB9CiAgICAgICAgKQogICAgICAgIHN5cy5zdGRvdXQuZmx1c2goKQogICAgICAgIGlmIHVwZGF0ZWRfc3RhdHVzLnVwcGVyKCkgPT0gIlJVTk5JTkciOgogICAgICAgICAgICBrdWJlcm5ldGVzX2FjY2Vzcy53YXRjaF9wb2RfbG9nc19hc3luYyhuYW1lc3BhY2UsIHBvZF9uYW1lLCBvbl9wb2RfbG9nKQoKZGVmIG9uX2pvYl91cGRhdGUoam9iKToKICAgIGdsb2JhbCBqb2Jfc3RhcnRlZAogICAgZ2xvYmFsIGpvYl9jb21wbGV0ZWQKICAgIGdsb2JhbCBzY2hlZHVsZWRfdGltZQogICAgZ2xvYmFsIG5hbWVzcGFjZQogICAgZ2xvYmFsIGt1YmVybmV0ZXNfYWNjZXNzCiAgICAKICAgIGlmIG5vdCBqb2Jfc3RhcnRlZCBhbmQgam9iLnN0YXR1cy5zdGFydF90aW1lIGlzIG5vdCBOb25lOgogICAgICAgIGpvYl9zdGFydGVkID0gVHJ1ZQogICAgICAgIHByaW50KAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibWVzc2FnZSI6ICJKb2Igc3RhcnRlZCIsCiAgICAgICAgICAgICAgICAic3RhcnRfdGltZSI6IGpvYi5zdGF0dXMuc3RhcnRfdGltZSwKICAgICAgICAgICAgICAgICJzY2hlZHVsZWRfdGltZSI6IHNjaGVkdWxlZF90aW1lCiAgICAgICAgICAgIH0KICAgICAgICApCiAgICAgICAgc3lzLnN0ZG91dC5mbHVzaCgpCiAgICAgICAgbGFiZWxfc2VsZWN0b3I9ZiJqb2ItbmFtZT17am9iLm1ldGFkYXRhLm5hbWV9IgogICAgICAgIGpvYl9wb2RzID0ga3ViZXJuZXRlc19hY2Nlc3MuZ2V0X3BvZChuYW1lc3BhY2U9bmFtZXNwYWNlLCBsYWJlbF9zZWxlY3Rvcj1sYWJlbF9zZWxlY3RvcikKICAgICAgICBpZiBsZW4oam9iX3BvZHMuaXRlbXMpID4gMDoKICAgICAgICAgICAgcG9kID0gam9iX3BvZHMuaXRlbXNbMF0KICAgICAgICAgICAga3ViZXJuZXRlc19hY2Nlc3Mud2F0Y2hfcG9kX2FzeW5jKG5hbWVzcGFjZSwgcG9kLm1ldGFkYXRhLm5hbWUsIGxhYmVsX3NlbGVjdG9yLCBvbl9wb2RfdXBkYXRlKQogICAgaWYgbm90IGpvYl9jb21wbGV0ZWQgYW5kIGpvYi5zdGF0dXMuY29tcGxldGlvbl90aW1lIGlzIG5vdCBOb25lOgogICAgICAgIGpvYl9jb21wbGV0ZWQgPSBUcnVlCiAgICAgICAgcHJpbnQoCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJtZXNzYWdlIjogIkpvYiBjb21wbGV0ZWQiLAogICAgICAgICAgICAgICAgImNvbXBsZXRpb25fdGltZSI6IGpvYi5zdGF0dXMuY29tcGxldGlvbl90aW1lCiAgICAgICAgICAgIH0KICAgICAgICApCiAgICAgICAgc3lzLnN0ZG91dC5mbHVzaCgpCiAgICAgICAgb3MuX2V4aXQoMCkKCnNjaGVkdWxlZF90aW1lID0gJ0BzZ2coInNjaGVkdWxlZF90aW1lIiknCgprd2FyZ3MgPSB5YW1sLnNhZmVfbG9hZCgiIiJAc2dnKCJGdW5jdGlvbkt3YXJncyIpIiIiKQoKbmFtZXNwYWNlID0ga3dhcmdzWyJuYW1lc3BhY2UiXQoKa3ViZXJuZXRlc19hY2Nlc3MgPSBLdWJlcm5ldGVzQWNjZXNzKG5hbWVzcGFjZSkKCmpvYl9uYW1lID0gY3JlYXRlX2t1YmVybmV0ZXNfam9iKCoqa3dhcmdzKQoKa3ViZXJuZXRlc19hY2Nlc3Mud2F0Y2hfam9iX2FzeW5jKG5hbWVzcGFjZSwgam9iX25hbWUsIG9uX2pvYl91cGRhdGUpCg==","teamUsable":true,"teamEditable":false,"isActive":true},{"name":"KubernetesAccess.py","scriptType":0,"code":"aW1wb3J0IGpzb24KaW1wb3J0IHJhbmRvbQppbXBvcnQgc3RyaW5nCmltcG9ydCBzeXMKCmZyb20ga3ViZXJuZXRlcyBpbXBvcnQgY2xpZW50LCBjb25maWcgYXMgazhzX2NvbmZpZywgd2F0Y2gKZnJvbSBrdWJlcm5ldGVzLmNsaWVudCBpbXBvcnQgVjFWb2x1bWVNb3VudApmcm9tIGt1YmVybmV0ZXMuY2xpZW50LnJlc3QgaW1wb3J0IEFwaUV4Y2VwdGlvbgoKZnJvbSB0aHJlYWRpbmcgaW1wb3J0IFRocmVhZAoKCmNsYXNzIEt1YmVybmV0ZXNBY2Nlc3Mob2JqZWN0KToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBuYW1lc3BhY2UpOgogICAgICAgIHNlbGYuX25hbWVzcGFjZSA9IG5hbWVzcGFjZQoKICAgICAgICBrOHNfY29uZmlnLmxvYWRfaW5jbHVzdGVyX2NvbmZpZygpCiAgICAgICAgc2VsZi5fY29uZmlndXJhdGlvbiA9IGNsaWVudC5Db25maWd1cmF0aW9uKCkKICAgICAgICAjIGdldCBhcGkgYWNjZXNzIHRva2VuCiAgICAgICAgdG9rZW5fZmlsZSA9IG9wZW4oIi92YXIvcnVuL3NlY3JldHMva3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC90b2tlbiIpCiAgICAgICAgdG9rZW4gPSB0b2tlbl9maWxlLnJlYWQoKQogICAgICAgIHRva2VuX2ZpbGUuY2xvc2UoKQogICAgICAgIHNlbGYuX2NvbmZpZ3VyYXRpb24uYXBpX2tleVsiYXV0aG9yaXphdGlvbiJdID0gdG9rZW4KICAgICAgICBzZWxmLl9jb25maWd1cmF0aW9uLmFwaV9rZXlfcHJlZml4WyJhdXRob3JpemF0aW9uIl0gPSAiQmVhcmVyIgogICAgICAgIHNlbGYuX2NvbmZpZ3VyYXRpb24uaG9zdCA9ICJodHRwczovL2t1YmVybmV0ZXMuZGVmYXVsdC5zdmMiCiAgICAgICAgc2VsZi5fY29uZmlndXJhdGlvbi52ZXJpZnlfc3NsID0gRmFsc2UKICAgICAgICBjbGllbnQuQ29uZmlndXJhdGlvbi5zZXRfZGVmYXVsdChzZWxmLl9jb25maWd1cmF0aW9uKQogICAgICAgIHNlbGYuX2FwaV9pbnN0ID0gY2xpZW50LkJhdGNoVjFBcGkoY2xpZW50LkFwaUNsaWVudChzZWxmLl9jb25maWd1cmF0aW9uKSkKICAgICAgICBzZWxmLl9jb3JlX3YxID0gY2xpZW50LkNvcmVWMUFwaSgpCgogICAgZGVmIGpvYl9pZF9nZW5lcmF0b3Ioc2VsZiwgc2l6ZT0xMiwgY2hhcnM9c3RyaW5nLmFzY2lpX2xvd2VyY2FzZSArIHN0cmluZy5kaWdpdHMpOgogICAgICAgIHJldHVybiAiIi5qb2luKHJhbmRvbS5jaG9pY2UoY2hhcnMpIGZvciBfIGluIHJhbmdlKHNpemUpKQoKICAgIGRlZiB3YXRjaF9qb2Ioc2VsZiwgbmFtZXNwYWNlLCBqb2JfbmFtZSwgZm5fb25fam9iX3VwZGF0ZSk6CiAgICAgICAgdyA9IHdhdGNoLldhdGNoKCkKICAgICAgICBmb3IgZXZlbnQgaW4gdy5zdHJlYW0oc2VsZi5fYXBpX2luc3QubGlzdF9uYW1lc3BhY2VkX2pvYiwgbmFtZXNwYWNlLCB0aW1lb3V0X3NlY29uZHM9MCk6CiAgICAgICAgICAgIGpvYiA9IGV2ZW50WyJvYmplY3QiXQogICAgICAgICAgICBpZiBqb2IubWV0YWRhdGEubmFtZSA9PSBqb2JfbmFtZToKICAgICAgICAgICAgICAgIGZuX29uX2pvYl91cGRhdGUoam9iKQoKICAgIGRlZiB3YXRjaF9qb2JfYXN5bmMoc2VsZiwgbmFtZXNwYWNlLCBqb2JfbmFtZSwgZm5fb25fam9iX3VwZGF0ZSk6CiAgICAgICAgd2F0Y2hfam9iX3RocmVhZCA9IFRocmVhZCh0YXJnZXQ9c2VsZi53YXRjaF9qb2IsIGFyZ3M9KG5hbWVzcGFjZSwgam9iX25hbWUsIGZuX29uX2pvYl91cGRhdGUpKQogICAgICAgIHdhdGNoX2pvYl90aHJlYWQuc3RhcnQoKQoKICAgIGRlZiB3YXRjaF9wb2Qoc2VsZiwgbmFtZXNwYWNlLCBwb2RfbmFtZSwgbGFiZWxfc2VsZWN0b3IsIGZuX29uX3BvZF91cGRhdGUpOgogICAgICAgIHcgPSB3YXRjaC5XYXRjaCgpCiAgICAgICAgZm9yIGV2ZW50IGluIHcuc3RyZWFtKHNlbGYuX2NvcmVfdjEubGlzdF9uYW1lc3BhY2VkX3BvZCwgbmFtZXNwYWNlLCBsYWJlbF9zZWxlY3Rvcj1sYWJlbF9zZWxlY3RvciwgdGltZW91dF9zZWNvbmRzPTApOgogICAgICAgICAgICBwb2QgPSBldmVudFsib2JqZWN0Il0KICAgICAgICAgICAgaWYgcG9kLm1ldGFkYXRhLm5hbWUgPT0gcG9kX25hbWU6CiAgICAgICAgICAgICAgICBmbl9vbl9wb2RfdXBkYXRlKHBvZCkKCiAgICBkZWYgd2F0Y2hfcG9kX2FzeW5jKHNlbGYsIG5hbWVzcGFjZSwgcG9kX25hbWUsIGxhYmVsX3NlbGVjdG9yLCBmbl9vbl9wb2RfdXBkYXRlKToKICAgICAgICB3YXRjaF9wb2RfdGhyZWFkID0gVGhyZWFkKHRhcmdldD1zZWxmLndhdGNoX3BvZCwgYXJncz0obmFtZXNwYWNlLCBwb2RfbmFtZSwgbGFiZWxfc2VsZWN0b3IsIGZuX29uX3BvZF91cGRhdGUpKQogICAgICAgIHdhdGNoX3BvZF90aHJlYWQuc3RhcnQoKQoKICAgIGRlZiB3YXRjaF9wb2RfbG9ncyhzZWxmLCBuYW1lc3BhY2UsIHBvZF9uYW1lLCBmbl9vbl9wb2RfbG9nKToKICAgICAgICB3ID0gd2F0Y2guV2F0Y2goKQogICAgICAgIGZvciBldmVudCBpbiB3LnN0cmVhbShzZWxmLl9jb3JlX3YxLnJlYWRfbmFtZXNwYWNlZF9wb2RfbG9nLCBuYW1lPXBvZF9uYW1lLCBuYW1lc3BhY2U9bmFtZXNwYWNlKToKICAgICAgICAgICAgZm5fb25fcG9kX2xvZyhldmVudCkKCiAgICBkZWYgd2F0Y2hfcG9kX2xvZ3NfYXN5bmMoc2VsZiwgbmFtZXNwYWNlLCBwb2RfbmFtZSwgZm5fb25fcG9kX2xvZyk6CiAgICAgICAgd2F0Y2hfcG9kX2xvZ3NfdGhyZWFkID0gVGhyZWFkKHRhcmdldD1zZWxmLndhdGNoX3BvZF9sb2dzLCBhcmdzPShuYW1lc3BhY2UsIHBvZF9uYW1lLCBmbl9vbl9wb2RfbG9nKSkKICAgICAgICB3YXRjaF9wb2RfbG9nc190aHJlYWQuc3RhcnQoKQoKICAgIGRlZiBnZXRfcG9kKHNlbGYsIG5hbWVzcGFjZT0iZGVmYXVsdCIsIGxhYmVsX3NlbGVjdG9yPSIiKToKICAgICAgICByZXR1cm4gc2VsZi5fY29yZV92MS5saXN0X25hbWVzcGFjZWRfcG9kKG5hbWVzcGFjZT1uYW1lc3BhY2UsIGxhYmVsX3NlbGVjdG9yPWxhYmVsX3NlbGVjdG9yKQoKICAgIGRlZiBjcmVhdGVfcG9kX3NwZWMoCiAgICAgICAgc2VsZiwKICAgICAgICBjb250YWluZXJfaW1hZ2UsCiAgICAgICAgaW1hZ2VfcHVsbF9wb2xpY3ksCiAgICAgICAgY29udGFpbmVyX25hbWUsCiAgICAgICAgc2VydmljZV9hY2NvdW50X25hbWUsCiAgICAgICAgY29tbWFuZD1Ob25lLAogICAgICAgIGVudl92YXJzPVtdLAogICAgICAgIHNlY3JldHM9W10sCiAgICAgICAgY29uZmlnX21hcHM9W10sCiAgICAgICAgYWZmaW5pdGllcz1bXSwKICAgICAgICB0b2xlcmF0aW9ucz1bXSwKICAgICAgICB2b2x1bWVfY2xhaW1zPVtdLAogICAgKToKCiAgICAgICAgZW52X2xpc3QgPSBbXQogICAgICAgIGlmIGVudl92YXJzIGFuZCBsZW4oZW52X3ZhcnMpID4gMDoKICAgICAgICAgICAgZm9yIGV2IGluIGVudl92YXJzOgogICAgICAgICAgICAgICAgZW52X2xpc3QuYXBwZW5kKGNsaWVudC5WMUVudlZhcihuYW1lPWV2WyJlbnZfbmFtZSJdLCB2YWx1ZT1ldlsiZW52X3ZhbHVlIl0pKQoKICAgICAgICBpZiBzZWNyZXRzIGFuZCBsZW4oc2VjcmV0cykgPiAwOgogICAgICAgICAgICBmb3Igc2VjcmV0IGluIHNlY3JldHM6CiAgICAgICAgICAgICAgICBlbnZfbGlzdC5hcHBlbmQoCiAgICAgICAgICAgICAgICAgICAgY2xpZW50LlYxRW52VmFyKAogICAgICAgICAgICAgICAgICAgICAgICBuYW1lPXNlY3JldFsiZW52X25hbWUiXSwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVfZnJvbT1jbGllbnQuVjFFbnZWYXJTb3VyY2UoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWNyZXRfa2V5X3JlZj1jbGllbnQuVjFTZWNyZXRLZXlTZWxlY3RvcigKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lPXNlY3JldFsic2VjcmV0X25hbWUiXSwga2V5PXNlY3JldFsic2VjcmV0X2tleSJdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgKQoKICAgICAgICBlbnZmcm9tX2xpc3QgPSBbXQogICAgICAgIGlmIGNvbmZpZ19tYXBzIGFuZCBsZW4oY29uZmlnX21hcHMpID4gMDoKICAgICAgICAgICAgZm9yIGNtIGluIGNvbmZpZ19tYXBzOgogICAgICAgICAgICAgICAgZW52ZnJvbSA9IGNsaWVudC5WMUVudkZyb21Tb3VyY2UoY2xpZW50LlYxQ29uZmlnTWFwRW52U291cmNlKG5hbWU9Y20pKQogICAgICAgICAgICAgICAgZW52ZnJvbV9saXN0LmFwcGVuZChlbnZmcm9tKQoKICAgICAgICB2b2x1bWVfbW91bnRzID0gW10KICAgICAgICBpZiB2b2x1bWVfY2xhaW1zIGFuZCBsZW4odm9sdW1lX2NsYWltcykgPiAwOgogICAgICAgICAgICBmb3IgdiBpbiB2b2x1bWVfY2xhaW1zOgogICAgICAgICAgICAgICAgdm9sdW1lX21vdW50ID0gY2xpZW50LlYxVm9sdW1lTW91bnQoCiAgICAgICAgICAgICAgICAgICAgbW91bnRfcGF0aD12WyJtb3VudHBhdGgiXSwgbmFtZT12WyJuYW1lIl0KICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIHZvbHVtZV9tb3VudHMuYXBwZW5kKHZvbHVtZV9tb3VudCkKCiAgICAgICAgY29udGFpbmVyID0gY2xpZW50LlYxQ29udGFpbmVyKAogICAgICAgICAgICBuYW1lPWNvbnRhaW5lcl9uYW1lLAogICAgICAgICAgICBpbWFnZT1jb250YWluZXJfaW1hZ2UsCiAgICAgICAgICAgIGltYWdlX3B1bGxfcG9saWN5PWltYWdlX3B1bGxfcG9saWN5LAogICAgICAgICAgICBlbnY9ZW52X2xpc3QsCiAgICAgICAgICAgIGVudl9mcm9tPWVudmZyb21fbGlzdCwKICAgICAgICAgICAgdm9sdW1lX21vdW50cz12b2x1bWVfbW91bnRzLAogICAgICAgICkKICAgICAgICBpZiBjb21tYW5kOgogICAgICAgICAgICBjb250YWluZXIuY29tbWFuZCA9IGNvbW1hbmQKICAgICAgICBjb250YWluZXJzID0gW2NvbnRhaW5lcl0KCiAgICAgICAgbm9kZV9hZmZpbml0eSA9IE5vbmUKICAgICAgICBpZiBhZmZpbml0aWVzIGFuZCBsZW4oYWZmaW5pdGllcykgPiAwOgogICAgICAgICAgICBub2RlX2FmZmluaXR5ID0ge30KICAgICAgICAgICAgbWF0Y2hfZXhwcmVzc2lvbnMgPSBbXQogICAgICAgICAgICBmb3IgYWZmaW5pdHkgaW4gYWZmaW5pdGllczoKICAgICAgICAgICAgICAgIG5vZGVfc2VsZWN0b3IgPSBjbGllbnQuVjFOb2RlU2VsZWN0b3JSZXF1aXJlbWVudCgKICAgICAgICAgICAgICAgICAgICBrZXk9YWZmaW5pdHlbImtleSJdLAogICAgICAgICAgICAgICAgICAgIG9wZXJhdG9yPWFmZmluaXR5WyJvcGVyYXRvciJdLAogICAgICAgICAgICAgICAgICAgIHZhbHVlcz1hZmZpbml0eVsidmFsdWVzIl0sCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICBtYXRjaF9leHByZXNzaW9ucy5hcHBlbmQobm9kZV9zZWxlY3RvcikKICAgICAgICAgICAgbm9kZVNlbGVjdG9yVGVybXMgPSBjbGllbnQuVjFOb2RlU2VsZWN0b3JUZXJtKAogICAgICAgICAgICAgICAgbWF0Y2hfZXhwcmVzc2lvbnM9bWF0Y2hfZXhwcmVzc2lvbnMKICAgICAgICAgICAgKQogICAgICAgICAgICBub2RlX2FmZmluaXR5ID0gY2xpZW50LlYxTm9kZUFmZmluaXR5KAogICAgICAgICAgICAgICAgcmVxdWlyZWRfZHVyaW5nX3NjaGVkdWxpbmdfaWdub3JlZF9kdXJpbmdfZXhlY3V0aW9uPWNsaWVudC5WMU5vZGVTZWxlY3RvcigKICAgICAgICAgICAgICAgICAgICBub2RlX3NlbGVjdG9yX3Rlcm1zPVtub2RlU2VsZWN0b3JUZXJtc10KICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICkKICAgICAgICBhZmZpbml0eSA9IGNsaWVudC5WMUFmZmluaXR5KG5vZGVfYWZmaW5pdHk9bm9kZV9hZmZpbml0eSkKCiAgICAgICAgbm9kZV90b2xlcmF0aW9ucyA9IFtdCiAgICAgICAgaWYgdG9sZXJhdGlvbnMgYW5kIGxlbih0b2xlcmF0aW9ucykgPiAwOgogICAgICAgICAgICBmb3IgdCBpbiB0b2xlcmF0aW9uczoKICAgICAgICAgICAgICAgIHRvbGVyYXRpb24gPSBjbGllbnQuVjFUb2xlcmF0aW9uKAogICAgICAgICAgICAgICAgICAgIGVmZmVjdD10WyJlZmZlY3QiXSwKICAgICAgICAgICAgICAgICAgICBrZXk9dFsia2V5Il0sCiAgICAgICAgICAgICAgICAgICAgb3BlcmF0b3I9dFsib3BlcmF0b3IiXSwKICAgICAgICAgICAgICAgICAgICB2YWx1ZT10WyJ2YWx1ZSJdLAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgbm9kZV90b2xlcmF0aW9ucy5hcHBlbmQodG9sZXJhdGlvbikKCiAgICAgICAgdm9sdW1lcyA9IFtdCiAgICAgICAgaWYgdm9sdW1lX2NsYWltcyBhbmQgbGVuKHZvbHVtZV9jbGFpbXMpID4gMDoKICAgICAgICAgICAgZm9yIHYgaW4gdm9sdW1lX2NsYWltczoKICAgICAgICAgICAgICAgIHZvbHVtZSA9IE5vbmUKICAgICAgICAgICAgICAgIGlmICJjbGFpbSIgaW4gdjoKICAgICAgICAgICAgICAgICAgICB2b2x1bWUgPSBjbGllbnQuVjFWb2x1bWUoCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU9dlsibmFtZSJdLAogICAgICAgICAgICAgICAgICAgICAgICBwZXJzaXN0ZW50X3ZvbHVtZV9jbGFpbT1jbGllbnQuVjFQZXJzaXN0ZW50Vm9sdW1lQ2xhaW1Wb2x1bWVTb3VyY2UoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFpbV9uYW1lPXZbImNsYWltIl0KICAgICAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICBlbGlmICJob3N0UGF0aCIgaW4gdjoKICAgICAgICAgICAgICAgICAgICB2b2x1bWUgPSBjbGllbnQuVjFWb2x1bWUoCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU9dlsibmFtZSJdLAogICAgICAgICAgICAgICAgICAgICAgICBob3N0X3BhdGg9Y2xpZW50LlYxSG9zdFBhdGhWb2x1bWVTb3VyY2UoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRoPXZbImhvc3RQYXRoIl1bInBhdGgiXQogICAgICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIGlmIHZvbHVtZToKICAgICAgICAgICAgICAgICAgICB2b2x1bWVzLmFwcGVuZCh2b2x1bWUpCgogICAgICAgIHJldHVybiBjbGllbnQuVjFQb2RTcGVjKAogICAgICAgICAgICBhZmZpbml0eT1hZmZpbml0eSwKICAgICAgICAgICAgY29udGFpbmVycz1jb250YWluZXJzLAogICAgICAgICAgICB0b2xlcmF0aW9ucz1ub2RlX3RvbGVyYXRpb25zLAogICAgICAgICAgICB2b2x1bWVzPXZvbHVtZXMsCiAgICAgICAgICAgIHJlc3RhcnRfcG9saWN5PSJOZXZlciIsCiAgICAgICAgICAgIHNlcnZpY2VfYWNjb3VudF9uYW1lPXNlcnZpY2VfYWNjb3VudF9uYW1lLAogICAgICAgICkKCiAgICBkZWYgY3JlYXRlX2pvYl9vYmplY3QoCiAgICAgICAgc2VsZiwKICAgICAgICBjb250YWluZXJfaW1hZ2UsCiAgICAgICAgaW1hZ2VfcHVsbF9wb2xpY3ksCiAgICAgICAgbmFtZXNwYWNlLAogICAgICAgIGNvbnRhaW5lcl9uYW1lLAogICAgICAgIHNlcnZpY2VfYWNjb3VudF9uYW1lLAogICAgICAgIGNvbW1hbmQ9Tm9uZSwKICAgICAgICBsYWJlbHM9e30sCiAgICAgICAgZW52X3ZhcnM9e30sCiAgICAgICAgc2VjcmV0cz17fSwKICAgICAgICBjb25maWdfbWFwcz17fSwKICAgICAgICBhZmZpbml0aWVzPVtdLAogICAgICAgIHRvbGVyYXRpb25zPVtdLAogICAgICAgIHZvbHVtZV9jbGFpbXM9W10sCiAgICApOgogICAgICAgIGJvZHkgPSBjbGllbnQuVjFKb2IoYXBpX3ZlcnNpb249ImJhdGNoL3YxIiwga2luZD0iSm9iIikKICAgICAgICAjIEVhY2ggSm9iIG11c3QgaGF2ZSBhIGRpZmZlcmVudCBuYW1lIQogICAgICAgIG5hbWUgPSBjb250YWluZXJfbmFtZSArICItIiArIHNlbGYuam9iX2lkX2dlbmVyYXRvcigpCiAgICAgICAgYm9keS5tZXRhZGF0YSA9IGNsaWVudC5WMU9iamVjdE1ldGEoCiAgICAgICAgICAgIG5hbWVzcGFjZT1uYW1lc3BhY2UsIG5hbWU9bmFtZSwgbGFiZWxzPWxhYmVscwogICAgICAgICkKICAgICAgICBib2R5LnN0YXR1cyA9IGNsaWVudC5WMUpvYlN0YXR1cygpCgogICAgICAgIHRlbXBsYXRlID0gY2xpZW50LlYxUG9kVGVtcGxhdGUoKQogICAgICAgIHRlbXBsYXRlLnRlbXBsYXRlID0gY2xpZW50LlYxUG9kVGVtcGxhdGVTcGVjKCkKCiAgICAgICAgdGVtcGxhdGUudGVtcGxhdGUuc3BlYyA9IHNlbGYuY3JlYXRlX3BvZF9zcGVjKAogICAgICAgICAgICBjb250YWluZXJfaW1hZ2UsCiAgICAgICAgICAgIGltYWdlX3B1bGxfcG9saWN5LAogICAgICAgICAgICBjb250YWluZXJfbmFtZSwKICAgICAgICAgICAgc2VydmljZV9hY2NvdW50X25hbWUsCiAgICAgICAgICAgIGNvbW1hbmQ9Y29tbWFuZCwKICAgICAgICAgICAgZW52X3ZhcnM9ZW52X3ZhcnMsCiAgICAgICAgICAgIHNlY3JldHM9c2VjcmV0cywKICAgICAgICAgICAgY29uZmlnX21hcHM9Y29uZmlnX21hcHMsCiAgICAgICAgICAgIGFmZmluaXRpZXM9YWZmaW5pdGllcywKICAgICAgICAgICAgdG9sZXJhdGlvbnM9dG9sZXJhdGlvbnMsCiAgICAgICAgICAgIHZvbHVtZV9jbGFpbXM9dm9sdW1lX2NsYWltcywKICAgICAgICApCiAgICAgICAgdGVtcGxhdGUudGVtcGxhdGUubWV0YWRhdGEgPSBjbGllbnQuVjFPYmplY3RNZXRhKGxhYmVscz1sYWJlbHMpCgogICAgICAgIGJvZHkuc3BlYyA9IGNsaWVudC5WMUpvYlNwZWMoCiAgICAgICAgICAgIHR0bF9zZWNvbmRzX2FmdGVyX2ZpbmlzaGVkPTAsIHRlbXBsYXRlPXRlbXBsYXRlLnRlbXBsYXRlCiAgICAgICAgKQogICAgICAgIHJldHVybiBib2R5CgogICAgZGVmIGNyZWF0ZV9qb2Ioc2VsZiwgbmFtZXNwYWNlLCBqb2Jfb2JqZWN0KToKICAgICAgICB0cnk6CiAgICAgICAgICAgIGFwaV9yZXNwb25zZSA9IHNlbGYuX2FwaV9pbnN0LmNyZWF0ZV9uYW1lc3BhY2VkX2pvYigKICAgICAgICAgICAgICAgIG5hbWVzcGFjZSwgam9iX29iamVjdCwgcHJldHR5PVRydWUKICAgICAgICAgICAgKQogICAgICAgICAgICBwcmludCgKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibWVzc2FnZSI6ICJDcmVhdGVkIG5ldyBqb2IiLAogICAgICAgICAgICAgICAgICAgICJuYW1lIjogYXBpX3Jlc3BvbnNlLm1ldGFkYXRhLm5hbWUsCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICkKICAgICAgICAgICAgc3lzLnN0ZG91dC5mbHVzaCgpCiAgICAgICAgICAgIHJldHVybiBhcGlfcmVzcG9uc2UubWV0YWRhdGEubmFtZQogICAgICAgIGV4Y2VwdCBBcGlFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm1lc3NhZ2UiOiAiRXJyb3IgY3JlYXRpbmcgbmV3IGpvYiIsCiAgICAgICAgICAgICAgICAgICAgImVycm9yIjogc3RyKGUpLAogICAgICAgICAgICAgICAgICAgICJtZXRob2QiOiAiY3JlYXRlX2pvYiIsCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICkKICAgICAgICAgICAgc3lzLnN0ZG91dC5mbHVzaCgp","teamUsable":true,"teamEditable":false,"isActive":true}]}